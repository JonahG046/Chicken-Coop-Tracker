<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chicken Coop Tracker Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Chicken Coop Tracker</h1>
    <p>Monitor Feed • Water • Eggs</p>
  </header>

  <nav>
    <a href="{{ url_for('feed') }}">Feed</a>
    <a href="{{ url_for('water') }}">Water</a>
    <a href="{{ url_for('eggs') }}">Eggs</a>
    <a href="{{ url_for('settings') }}">Settings</a>
  </nav>

  <div class="container dashboard">

<!-- Feed Card -->
    <div class="card" id="feedCard">
      <h2>Feed</h2>
      <canvas id="feedChart"></canvas>
      <a href="{{ url_for('feed') }}">Go to Feed</a>
    </div>

    <!-- Water Card -->
    <div class="card" id="waterCard">
      <h2>Water</h2>
      <canvas id="waterChart"></canvas>
      <a href="{{ url_for('water') }}">Go to Water</a>
    </div>

    <!-- Eggs Card -->
    <div class="card">
      <h2>Eggs</h2>
      <canvas id="eggChart"></canvas>
      <a href="{{ url_for('eggs') }}">Go to Eggs</a>
    </div>

  </div>

  <footer>
    &copy; 2025 Chicken Coop Tracker
  </footer>

  <script>
    // Convert Python dictionaries to JS
    const feedData = {{ feed_data|tojson }};
    const waterData = {{ water_data|tojson }};
    const eggData = {{ egg_data|tojson }};

    function renderChart(ctx, data, label, color) {
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: label,
            data: Object.values(data),
            borderColor: color,
            backgroundColor: 'transparent',
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    renderChart(document.getElementById('feedChart'), feedData, 'Feed (lbs)', 'green');
    renderChart(document.getElementById('waterChart'), waterData, 'Water (L)', 'blue');
    renderChart(document.getElementById('eggChart'), eggData, 'Eggs (count)', 'orange');
  </script>

  <script>
  function checkLowLevels(data, containerId, threshold) {
    const container = document.getElementById(containerId);

    // Get the last value in the dataset
    const values = Object.values(data).map(Number);
    const latestValue = values[values.length - 1];  // last value

    if (latestValue < threshold) {
        container.classList.add('flash-red');

        if (!container.querySelector('.low-label')) {
            const label = document.createElement('div');
            label.classList.add('low-label');
            label.style.position = 'absolute';
            label.style.top = '10px';
            label.style.right = '10px';
            label.style.color = 'white';
            label.style.fontWeight = 'bold';
            label.style.fontSize = '1.2rem';
            label.innerText = 'LOW';
            container.style.position = 'relative';
            container.appendChild(label);
        }
    }
}

  // Define thresholds
  const FEED_THRESHOLD = 7;  // lbs
  const WATER_THRESHOLD = 2; // liters

  checkLowLevels(feedData, 'feedCard', FEED_THRESHOLD);
  checkLowLevels(waterData, 'waterCard', WATER_THRESHOLD);
</script>
</body>
</html>